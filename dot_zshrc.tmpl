# .zshrc 

HISTFILE=~/.histfile
HISTSIZE=1000
SAVEHIST=1000
setopt appendhistory autocd beep extendedglob nomatch notify
bindkey -e

zstyle :compinstall filename '/afs/cern.ch/user/l/liko/.zshrc'
autoload -Uz compinit

# pyenv init
if command -v pyenv 1>/dev/null 2>&1; then
    eval "$(pyenv init -)"
fi


# optional
# if [ -z "$PYENV_VIRTUALENV_INIT" ]; then
#    eval "$(pyenv virtualenv-init -)"
# fi
#

# powerline-go https://github.com/justjanne/powerline-go
POWERLINEOPTS="\
 -max-width 50 \
 -path-aliases /eos/user/l/liko=EOS \
 -theme default\
 -hostname-only-if-ssh \
 -duration-min 10 \
 -cwd-max-dir-size 8 \
 -static-prompt-indicator \
 -modules ssh,host,cwd,perms,git,jobs \
 -modules-right exit,venv,duration"

POWERLINECMD=$HOME/.local/bin/powerline-go

zmodload zsh/datetime

function preexec() {
  _TIMER=$EPOCHREALTIME
}

function powerline_precmd() {
    local _err=$?
    local _tim=0

    if [ -n $__TIMER ]; then
        local _ert=$EPOCHREALTIME
        _del="$(($_ert - ${_TIMER:-$_ert}))"
    fi

    eval "$($POWERLINECMD -eval ${=POWERLINEOPTS} -duration $_del -error $_err)"

    unset __TIMER
}

function install_powerline_precmd() {
  for s in "${precmd_functions[@]}"; do
    if [ "$s" = "powerline_precmd" ]; then
      return
    fi
  done
  precmd_functions+=(powerline_precmd)
}

if [ "$TERM" != "linux" ]; then
    install_powerline_precmd
fi
